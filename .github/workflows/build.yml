name: Build

on: 
  push:
  pull_request:
    types:
      [opened, synchronize]
    
jobs:
  build:
    runs-on: ubuntu-latest

    container:
      image: hulkhan/bannerlordcoop:1.0.1
      credentials:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}
      volumes:
        - ${{ github.workspace }}:/workspace
        - /home/runner/work/BannerlordCoop/assemblies:/usr/local/mb2
    
    steps:
          
      - name: Checkout Repo
        run: |
          git clone https://github.com/${{ github.repository }}
          cd BannerlordCoop
          git checkout "${{ github.ref_name }}"

      - name: Copy Assemblies
        run: |
          cp -R ../assemblies BannerlordCoop/mb2
          
      - name: Build Solution
        run: |
          echo "Running pwd"
          pwd
          echo "Running ls"
          ls
          echo "Running cd.."
          cd ..
          echo "Running ls"
          ls
          echo "Running cd assemblies"
          cd assemblies
          echo "Running pwd"
          pwd
          echo "Running ls"
          ls
          echo "Running cd BannerlordCoop/source"
          cd BannerlordCoop/source
          dotnet build